name: Spring boot build test

on:
  pull_request:
    branches:
      - Develop

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      AWS_ACCESS_KEY_ID: "mock-aws-access-key-id"
      AWS_SECRET_ACCESS_KEY: "mock-aws-secret-access-key"
      AWS_DEFAULT_REGION: "mock-aws-region"
      S3_BUCKET: "mock-s3-bucket-name"
      JWT_SECRET: "mock-jwt-secret"
      MYSQL_USERNAME: "mock-mysql-username"
      MYSQL_PASSWORD: "mock-mysql-password"
      DB_URL: "mock-db-url"
      GOOGLE_CLIENT_ID: "mock-google-client-id"
      GOOGLE_CLIENT_SECRET: "mock-google-client-secret"
      GOOGLE_REDIRECT_URI: "mock-google-redirect-uri"
      KAKAO_CLIENT_ID: "mock-kakao-client-id"
      KAKAO_CLIENT_SECRET: "mock-kakao-client-secret"
      KAKAO_REDIRECT_URI: "mock-kakao-redirect-uri"

    steps:
      - name: ✔️ 리포지토리 가져오기
        uses: actions/checkout@v4

      - name: ✔️ JDK 17 설치
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: ✔️ Gradle 명령 실행 권한 설정
        run: chmod +x gradlew

      - name: ✔️ Debugging Environment Variables
        run: |
          echo "🔍 AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID"
          echo "🔍 AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY"
          echo "🔍 AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION"
          echo "🔍 S3_BUCKET: $S3_BUCKET"
          echo "🔍 JWT_SECRET: $JWT_SECRET"
          echo "🔍 MYSQL_USERNAME: $MYSQL_USERNAME"
          echo "🔍 MYSQL_PASSWORD: $MYSQL_PASSWORD"
          echo "🔍 DB_URL: $DB_URL"
          echo "🔍 GOOGLE_CLIENT_ID: $GOOGLE_CLIENT_ID"
          echo "🔍 GOOGLE_CLIENT_SECRET: $GOOGLE_CLIENT_SECRET"
          echo "🔍 GOOGLE_REDIRECT_URI: $GOOGLE_REDIRECT_URI"
          echo "🔍 KAKAO_CLIENT_ID: $KAKAO_CLIENT_ID"
          echo "🔍 KAKAO_CLIENT_SECRET: $KAKAO_CLIENT_SECRET"
          echo "🔍 KAKAO_REDIRECT_URI: $KAKAO_REDIRECT_URI"

      - name: ✔️ Gradle build
        run: ./gradlew build -x installLocalGitHook -x spotlessInternalRegisterDependencies -x spotlessJava -x spotlessJavaApply -x spotlessApply -x spotlessJavaCheck -x spotlessCheck -x test

      - name: ✔️ Gradle test
        run: ./gradlew --info test -Dspring.profiles.active=test
